plugins {
    id 'base'
}
apply from: 'metadata.gradle'

def outputDir = project.property('assetpack')

shaders.each { shaderFileName, stages ->

    stages.each { stage ->

        def outputName = outputDir + File.separator + shaderFileName + "_" + stage + ".spv"



        def t = tasks.register("compile_${shaderFileName}_${stage}", Exec) {

            inputs.file("${shaderFileName}.slang")
            outputs.file(outputName)

            commandLine 'slangc', "${shaderFileName}.slang",
                    '-target', 'spirv',
                    '-matrix-layout-column-major',
                    '-o', outputName,
                    '-stage', stage,
                    '-entry', "${stage}Main"

            standardOutput = System.out
            errorOutput = System.err
        }
    }
}

task compile {
    dependsOn tasks.matching { it.name.startsWith('compile_') }

}